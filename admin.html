<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Privada | Don Tasko</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #1c1e21; }
        
        /* Estilos do Login */
        #login-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #2c3e50; display: flex; justify-content: center; align-items: center; z-index: 1000; 
        }
        .login-box { background: white; padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .login-box input { padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; display: block; }
        .login-box button { background: #27ae60; color: white; border: none; padding: 10px 25px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* Dashboard */
        #dashboard-content { display: none; max-width: 1200px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { margin-top: 0; font-size: 18px; color: #2c3e50; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; }
        
        /* FormulÃ¡rio Manual */
        .form-manual input, .form-manual select, .form-manual textarea { 
            width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;
        }
        .btn-add { background: #27ae60; color: white; border: none; width: 100%; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* Lista 15 dias com scroll */
        .scroll-resumo { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .dia-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #f0f2f5; border-radius: 6px; margin-bottom: 2px; }
        
        /* Cores de Alerta */
        .status-ok { background: #e8f5e9; border-left: 5px solid #2ecc71; }
        .status-warning { background: #fff3e0; border-left: 5px solid #f39c12; }
        .status-full { background: #ffebee; border-left: 5px solid #e74c3c; }

        .pax-badge { background: #2c3e50; color: white; padding: 2px 8px; border-radius: 6px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { text-align: left; padding: 12px; background: #f8f9fa; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .obs-text { font-size: 11px; color: #606770; font-style: italic; }
        .btn-refresh { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: #e74c3c; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="border:none">Acesso Restrito</h2>
        <input type="password" id="passInput" placeholder="Palavra-passe">
        <button onclick="verificarPass()">Entrar</button>
        <p id="erro" style="color:red; display:none; margin-top:10px;">Incorreto!</p>
    </div>
</div>

<div id="dashboard-content">
    <div class="header">
        <h1>ðŸ“Š Painel Administrativo Don Tasko</h1>
        <button class="btn-refresh" onclick="carregarDados()">ðŸ”„ Atualizar Dados</button>
    </div>

    <div class="container">
        <div>
            <div class="card">
                <h2>âž• Reserva Manual</h2>
                <form id="formManual" class="form-manual">
                    <input type="text" name="nome" placeholder="Nome do Cliente" required>
                    <input type="tel" name="telemovel" placeholder="TelemÃ³vel" required>
                    <div style="display:flex; gap:10px;">
                        <input type="date" name="data" id="dataManual" required>
                        <input type="number" name="pax" value="2" min="1" required>
                    </div>
                    <select name="horario" id="horarioManual">
                        <option value="12:30">12:30</option>
                        <option value="13:00">13:00</option>
                        <option value="19:30">19:30</option>
                        <option value="20:00">20:00</option>
                    </select>
                    <textarea name="obs" rows="2" placeholder="Notas internas (Mesa, Alergias...)"></textarea>
                    <button type="submit" class="btn-add" id="btnManual">Gravar Reserva</button>
                </form>
            </div>

            <div class="card">
                <h2>ðŸ“… OcupaÃ§Ã£o (15 Dias)</h2>
                <div id="resumo15" class="scroll-resumo">Carregando ocupaÃ§Ã£o...</div>
            </div>
        </div>

        <div class="card">
            <h2>Reservas para Hoje</h2>
            <table id="tabelaHoje">
                <thead>
                    <tr>
                        <th>Hora</th>
                        <th>Cliente</th>
                        <th>Pax</th>
                        <th>Notas</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5">A carregar reservas...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbzrkJHBd6OxOi71BV-Vd3-I7WtCTfB_K54XFcH4R4DZuvQkb_CBvzM89JS4kmUgOu6k/exec";
    const PASS_CORRETA = "Tasko123";
    const LOTACAO_MAX = 34;

    function verificarPass() {
        if (document.getElementById('passInput').value === PASS_CORRETA) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard-content').style.display = 'block';
            document.getElementById('dataManual').value = new Date().toISOString().split('T')[0];
            carregarDados();
        } else {
            document.getElementById('erro').style.display = 'block';
        }
    }

    document.getElementById('passInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') verificarPass(); });

    function carregarDados() {
        fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({action: 'getDashboard'}) })
        .then(r => r.json())
        .then(data => {
            // Renderizar Resumo 15 dias
            const resumoDiv = document.getElementById('resumo15');
            resumoDiv.innerHTML = Object.keys(data.resumo).sort().map(d => {
                const total = data.resumo[d];
                let classe = "status-ok";
                if (total >= LOTACAO_MAX) classe = "status-full";
                else if (total >= 25) classe = "status-warning";
                
                return `<div class="dia-item ${classe}">
                    <span>${d}</span>
                    <span class="pax-badge">${total} pax</span>
                </div>`;
            }).join('');

            // Renderizar Tabela Hoje
            const tbody = document.querySelector('#tabelaHoje tbody');
            tbody.innerHTML = data.listaHoje.length > 0 ? data.listaHoje.map(r => `
                <tr>
                    <td><strong>${r.hora}</strong></td>
                    <td>${r.nome}<br><small>${r.tel}</small></td>
                    <td><span class="pax-badge">${r.pax}</span></td>
                    <td class="obs-text">${r.obs || "---"}</td>
                    <td><button class="btn-cancel" onclick="cancelarReserva('${r.nome}', '${r.hora}')">Cancelar</button></td>
                </tr>
            `).join('') : "<tr><td colspan='5' style='text-align:center;'>Sem reservas para hoje.</td></tr>";
        });
    }

    function cancelarReserva(nome, hora) {
        if (confirm(`Deseja mesmo cancelar a reserva de ${nome} Ã s ${hora}?`)) {
            fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({action: 'cancelarAdmin', nome: nome, hora: hora}) })
            .then(() => { alert("Reserva cancelada!"); carregarDados(); });
        }
    }

    document.getElementById('formManual').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnManual');
        btn.disabled = true; btn.innerText = "Gravando...";

        const dados = Object.fromEntries(new FormData(this).entries());
        dados.action = "reservaManual";

        fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify(dados) })
        .then(r => r.json())
        .then(res => {
            alert("Reserva manual gravada!");
            this.reset();
            document.getElementById('dataManual').value = new Date().toISOString().split('T')[0];
            btn.disabled = false; btn.innerText = "Gravar Reserva";
            carregarDados();
        });
    };
</script>
</body>
</html>





