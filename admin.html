<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin + HACCP | Don Tasko</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* LOGIN */
        #login-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            display: flex; justify-content: center; align-items: center; z-index: 1000; 
        }
        
        .login-box { 
            background: white; padding: 50px 40px; border-radius: 20px; 
            box-shadow: 0 20px 80px rgba(0,0,0,0.4); min-width: 350px;
        }
        
        .login-box h2 { 
            margin-bottom: 30px; color: #2c3e50; font-size: 28px; 
            text-align: center; font-weight: 700;
        }
        
        .login-box input { 
            padding: 14px; width: 100%; border: 2px solid #e0e0e0; 
            border-radius: 10px; margin-bottom: 20px; font-size: 15px;
        }
        
        .login-box button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 14px; border-radius: 10px; 
            cursor: pointer; font-weight: 600; font-size: 16px; width: 100%;
        }
        
        .erro { 
            color: #e74c3c; margin-top: 15px; font-size: 14px; 
            text-align: center; display: none; font-weight: 500;
        }

        /* DASHBOARD */
        #dashboard-content { display: none; max-width: 1800px; margin: 0 auto; }
        
        .header { 
            background: white; padding: 25px 30px; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 25px;
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; gap: 15px;
        }
        
        .header h1 { 
            font-size: 26px; color: #2c3e50; font-weight: 700;
            display: flex; align-items: center; gap: 10px;
        }
        
        .header-actions {
            display: flex; gap: 12px; flex-wrap: wrap;
        }
        
        .btn-header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 12px 24px; 
            border-radius: 10px; cursor: pointer; font-weight: 600;
            display: flex; align-items: center; gap: 8px; font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-logout {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        /* TABS */
        .tabs {
            background: white;
            border-radius: 16px;
            padding: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* CARDS */
        .card { 
            background: white; border-radius: 16px; padding: 30px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card h2 { 
            margin: 0 0 20px 0; font-size: 18px; color: #2c3e50; 
            border-bottom: 3px solid #f0f2f5; padding-bottom: 12px; 
            font-weight: 700; display: flex; align-items: center; gap: 10px;
        }
        
        /* HACCP GRID */
        .haccp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .haccp-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        
        .haccp-card.warning {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
        }
        
        .haccp-card.danger {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }
        
        .haccp-card .title {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .haccp-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .haccp-card .subtitle {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
        }
        
        /* TABELA */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        
        table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
            color: #495057;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* FILTROS */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn-filter {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            align-self: flex-end;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }
        
        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        /* RESERVAS (do c√≥digo anterior) */
        .container-principal {
            display: grid;
            grid-template-columns: 350px 1fr 450px;
            gap: 25px;
        }
        
        @media (max-width: 1400px) {
            .container-principal {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
    <div class="login-box">
        <h2>üîí Acesso Admin</h2>
        <input 
            type="password" 
            id="passInput" 
            placeholder="Palavra-passe" 
            autocomplete="current-password"
        >
        <button onclick="verificarPass()">Entrar</button>
        <p class="erro" id="erro">‚ö†Ô∏è Palavra-passe incorreta!</p>
    </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard-content">
    
    <!-- HEADER -->
    <div class="header">
        <h1>
            <span>üìä</span>
            <span>Painel Administrativo Don Tasko</span>
        </h1>
        <div class="header-actions">
            <button class="btn-header" onclick="carregarDados()">
                <span>üîÑ</span>
                <span>Atualizar</span>
            </button>
            <button class="btn-header btn-logout" onclick="logout()">
                <span>üö™</span>
                <span>Sair</span>
            </button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" onclick="mudarTab('reservas')">
            üçΩÔ∏è Reservas
        </button>
        <button class="tab-btn" onclick="mudarTab('haccp')">
            üß™ HACCP
        </button>
    </div>

    <!-- TAB RESERVAS -->
    <div id="tab-reservas" class="tab-content active">
        <div class="card">
            <h2>üçΩÔ∏è Sistema de Reservas</h2>
            <p style="color: #7f8c8d; margin-top: -10px;">
                Ver <a href="admin-fixed.html" style="color: #667eea; font-weight: 600;">p√°gina completa de reservas ‚Üí</a>
            </p>
        </div>
    </div>

    <!-- TAB HACCP -->
    <div id="tab-haccp" class="tab-content">
        
        <!-- RESUMO DO DIA -->
        <div class="card">
            <h2>üìä Resumo de Hoje</h2>
            
            <div class="haccp-grid">
                <div class="haccp-card">
                    <div class="title">üå°Ô∏è Temperaturas</div>
                    <div class="value" id="stat-temperaturas">-</div>
                    <div class="subtitle">registos hoje</div>
                </div>
                
                <div class="haccp-card">
                    <div class="title">üßº Limpezas</div>
                    <div class="value" id="stat-limpezas">-</div>
                    <div class="subtitle">conclu√≠das</div>
                </div>
                
                <div class="haccp-card">
                    <div class="title">‚úÖ Checklists</div>
                    <div class="value" id="stat-checklists">-</div>
                    <div class="subtitle">preenchidas</div>
                </div>
                
                <div class="haccp-card" id="card-alertas">
                    <div class="title">‚ö†Ô∏è Alertas</div>
                    <div class="value" id="stat-alertas">-</div>
                    <div class="subtitle">ocorr√™ncias</div>
                </div>
            </div>
        </div>
        
        <!-- FILTROS -->
        <div class="card">
            <h2>üîç Consultar Registos</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label>Tipo de Registo</label>
                    <select id="filtro-tipo">
                        <option value="">Todos</option>
                        <option value="temperaturas">üå°Ô∏è Temperaturas</option>
                        <option value="limpeza">üßº Limpeza</option>
                        <option value="checklist">‚úÖ Checklist</option>
                        <option value="oleo">üçü √ìleo</option>
                        <option value="rececao">üì¶ Rece√ß√£o</option>
                        <option value="ocorrencia">‚ö†Ô∏è Ocorr√™ncias</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Data In√≠cio</label>
                    <input type="date" id="filtro-data-inicio">
                </div>
                
                <div class="filter-group">
                    <label>Data Fim</label>
                    <input type="date" id="filtro-data-fim">
                </div>
                
                <button class="btn-filter" onclick="filtrarRegistos()">
                    üîç Filtrar
                </button>
            </div>
        </div>
        
        <!-- REGISTOS RECENTES -->
        <div class="card">
            <h2>üìã Registos Recentes</h2>
            
            <div class="table-container" id="registos-container">
                <div class="empty-state">
                    <div class="icon">üì≠</div>
                    <p>Nenhum registo encontrado</p>
                </div>
            </div>
        </div>
        
        <!-- ALERTAS E OCORR√äNCIAS -->
        <div class="card">
            <h2>‚ö†Ô∏è Ocorr√™ncias e Alertas</h2>
            
            <div id="ocorrencias-container">
                <div class="empty-state">
                    <div class="icon">‚úÖ</div>
                    <p>Nenhuma ocorr√™ncia registada</p>
                </div>
            </div>
        </div>
        
    </div>

</div>

<script>
    const CONFIG = {
        URL_SCRIPT: "https://script.google.com/macros/s/AKfycbzFAeZ1kKdtxAwxQ1xARNT02DJUl0nUznIqTlAVKNeI98KNeqiSUKyWbJ41MpILjPuP/exec",
        PASS_CORRETA: "Tasko123"
    };

    let dadosHACCP = [];

    // LOGIN
    function verificarPass() {
        const senha = document.getElementById('passInput').value;
        
        if (senha === CONFIG.PASS_CORRETA) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard-content').style.display = 'block';
            
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('filtro-data-inicio').value = hoje;
            document.getElementById('filtro-data-fim').value = hoje;
            
            carregarDados();
        } else {
            const erroEl = document.getElementById('erro');
            erroEl.style.display = 'block';
            setTimeout(() => erroEl.style.display = 'none', 3000);
        }
    }

    function logout() {
        if (confirm('Sair do painel?')) {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('passInput').value = '';
        }
    }

    document.getElementById('passInput').addEventListener('keypress', (e) => { 
        if (e.key === 'Enter') verificarPass(); 
    });

    // TABS
    function mudarTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById('tab-' + tab).classList.add('active');
        
        if (tab === 'haccp') {
            carregarDadosHACCP();
        }
    }

    // CARREGAR DADOS
    async function carregarDados() {
        carregarDadosHACCP();
    }

    async function carregarDadosHACCP() {
        try {
            const response = await fetch(CONFIG.URL_SCRIPT, {
                method: 'POST',
                body: JSON.stringify({ action: 'getDashboardHACCP' })
            });
            
            const data = await response.json();
            
            if (data.status === 'success') {
                dadosHACCP = data.registos || [];
                atualizarStats(dadosHACCP);
                renderizarRegistos(dadosHACCP);
                renderizarOcorrencias(dadosHACCP);
            }
            
        } catch (error) {
            console.error('Erro ao carregar HACCP:', error);
        }
    }

    function atualizarStats(registos) {
        const hoje = new Date().toISOString().split('T')[0];
        const registosHoje = registos.filter(r => r.data === hoje);
        
        const temperaturas = registosHoje.filter(r => r.tipo === 'temperaturas').length;
        const limpezas = registosHoje.filter(r => r.tipo === 'limpeza').length;
        const checklists = registosHoje.filter(r => r.tipo === 'checklist').length;
        const alertas = registosHoje.filter(r => r.tipo === 'ocorrencia').length;
        
        document.getElementById('stat-temperaturas').textContent = temperaturas;
        document.getElementById('stat-limpezas').textContent = limpezas;
        document.getElementById('stat-checklists').textContent = checklists;
        document.getElementById('stat-alertas').textContent = alertas;
        
        const cardAlertas = document.getElementById('card-alertas');
        if (alertas > 0) {
            cardAlertas.classList.add('danger');
        } else {
            cardAlertas.classList.remove('danger');
        }
    }

    function renderizarRegistos(registos) {
        const container = document.getElementById('registos-container');
        
        if (registos.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üì≠</div>
                    <p>Nenhum registo encontrado</p>
                </div>
            `;
            return;
        }
        
        const icones = {
            'temperaturas': 'üå°Ô∏è',
            'limpeza': 'üßº',
            'checklist': '‚úÖ',
            'oleo': 'üçü',
            'rececao': 'üì¶',
            'ocorrencia': '‚ö†Ô∏è'
        };
        
        const html = `
            <table>
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Tipo</th>
                        <th>Detalhes</th>
                        <th>Funcion√°rio</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${registos.slice(0, 50).map(r => `
                        <tr>
                            <td>${r.data} ${r.hora}</td>
                            <td>${icones[r.tipo] || 'üìù'} ${formatarTipo(r.tipo)}</td>
                            <td>${formatarDetalhes(r)}</td>
                            <td>${r.funcionario || '-'}</td>
                            <td>${getBadgeStatus(r)}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        
        container.innerHTML = html;
    }

    function renderizarOcorrencias(registos) {
        const container = document.getElementById('ocorrencias-container');
        const ocorrencias = registos.filter(r => r.tipo === 'ocorrencia');
        
        if (ocorrencias.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">‚úÖ</div>
                    <p>Nenhuma ocorr√™ncia registada</p>
                </div>
            `;
            return;
        }
        
        const html = ocorrencias.map(o => `
            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #e74c3c;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <strong>${o.tipoOcorrencia || 'Ocorr√™ncia'}</strong>
                    <span style="font-size: 12px; color: #666;">${o.data} ${o.hora}</span>
                </div>
                <p style="margin-bottom: 8px;">${o.descricao || '-'}</p>
                ${o.acao ? `<p style="font-size: 13px; color: #666;"><strong>A√ß√£o:</strong> ${o.acao}</p>` : ''}
                <p style="font-size: 12px; color: #666; margin-top: 8px;">Reportado por: ${o.funcionario}</p>
            </div>
        `).join('');
        
        container.innerHTML = html;
    }

    function filtrarRegistos() {
        const tipo = document.getElementById('filtro-tipo').value;
        const dataInicio = document.getElementById('filtro-data-inicio').value;
        const dataFim = document.getElementById('filtro-data-fim').value;
        
        let filtrados = dadosHACCP;
        
        if (tipo) {
            filtrados = filtrados.filter(r => r.tipo === tipo);
        }
        
        if (dataInicio) {
            filtrados = filtrados.filter(r => r.data >= dataInicio);
        }
        
        if (dataFim) {
            filtrados = filtrados.filter(r => r.data <= dataFim);
        }
        
        renderizarRegistos(filtrados);
    }

    function formatarTipo(tipo) {
        const tipos = {
            'temperaturas': 'Temperatura',
            'limpeza': 'Limpeza',
            'checklist': 'Checklist',
            'oleo': '√ìleo',
            'rececao': 'Rece√ß√£o',
            'ocorrencia': 'Ocorr√™ncia'
        };
        return tipos[tipo] || tipo;
    }

    function formatarDetalhes(r) {
        switch(r.tipo) {
            case 'temperaturas':
                return `${r.equipamento}: ${r.temperatura}¬∞C`;
            case 'limpeza':
                return `${r.area} - ${r.tipoLimpeza}`;
            case 'oleo':
                return `${r.acao} - Estado: ${r.estado}`;
            case 'rececao':
                return `${r.fornecedor}`;
            case 'ocorrencia':
                return `${r.tipoOcorrencia}`;
            default:
                return '-';
        }
    }

    function getBadgeStatus(r) {
        if (r.tipo === 'temperaturas') {
            const temp = parseFloat(r.temperatura);
            if (temp > 4 && temp < 60) {
                return '<span class="badge badge-danger">‚ö†Ô∏è Zona Perigo</span>';
            }
            return '<span class="badge badge-success">‚úÖ OK</span>';
        }
        
        if (r.tipo === 'rececao') {
            if (r.estado === 'Nao Conforme') {
                return '<span class="badge badge-danger">‚ùå N√£o Conforme</span>';
            }
            return '<span class="badge badge-success">‚úÖ Conforme</span>';
        }
        
        if (r.tipo === 'ocorrencia') {
            return '<span class="badge badge-danger">‚ö†Ô∏è Alerta</span>';
        }
        
        return '<span class="badge badge-info">üìù Registado</span>';
    }
</script>

</body>
</html>

