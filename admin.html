<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:Arial;
  background:#f5f6fa;
  margin:0;
  padding:20px;
}
.card{
  background:white;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.alerta{color:#c0392b;font-weight:bold;}
.ok{color:#27ae60;font-weight:bold;}
</style>
</head>

<body>

<h2>ğŸ“Š Dashboard HACCP</h2>
<div id="conteudo">A carregar...</div>

<script>

const URL = "https://script.google.com/macros/s/AKfycby5RmGeAWc4BhYsKLDsIgpBKpx_ZRgg2cwuB-viaQkJiI-d_pHmWJWcRQxm-RVPqrq7/exec";

async function carregar(){

  try{

    const response = await fetch(URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ action:"getDashboardHACCP" })
    });

    const json = await response.json();

    if(!json.registos || json.registos.length==0){
      document.getElementById("conteudo").innerHTML="Sem registos HACCP";
      return;
    }

    let html="";

    json.registos.forEach(r=>{

      const temp = Number(r.temperatura);

      const alerta = (temp < 0 || temp > 5)
        ? "<span class='alerta'>âš  Fora do intervalo</span>"
        : "<span class='ok'>âœ” OK</span>";

      html += `
        <div class="card">
          <b>${r.equipamento || "-"}</b><br>
          ğŸŒ¡ ${temp}ÂºC ${alerta}<br>
          ğŸ‘¨â€ğŸ³ ${r.funcionario || "-"}<br>
          ğŸ“… ${r.data || "-"}
        </div>
      `;
    });

    document.getElementById("conteudo").innerHTML = html;

  }catch(e){
    console.log(e);
    document.getElementById("conteudo").innerHTML="Erro ao carregar dashboard";
  }
}

carregar();
setInterval(carregar,15000);

</script>

</body>
</html>
