<script>
    const WEB_APP_URL = "VALOR_DO_TEU_URL_AQUI";

    // Função para carregar horários dinâmicos da aba Restaurantes
    window.onload = function() {
        fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify({ action: "getHorarios" })
        })
        .then(res => res.json())
        .then(horarios => {
            const select = document.getElementById('horario');
            if (horarios && horarios.length > 0) {
                select.innerHTML = ""; 
                horarios.forEach(h => {
                    let opt = document.createElement('option');
                    opt.value = h;
                    opt.textContent = h;
                    select.appendChild(opt);
                });
            }
        })
        .catch(err => console.log("Erro ao carregar horários: ", err));
    };

    // Função de submissão da reserva
    document.getElementById('reservaForm').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('loader').style.display = 'block';
        document.getElementById('btnTexto').disabled = true;
        
        const formData = new FormData(this);
        const dados = Object.fromEntries(formData.entries());
        dados.action = "reserva";

        fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify(dados),
            mode: 'cors'
        })
        .then(response => response.json())
        .then(res => {
            if (res.status === "success") {
                alert("Reserva confirmada no Don Tasko!");
                location.reload();
            } else {
                alert("Erro: " + res.message);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('btnTexto').disabled = false;
            }
        })
        .catch(err => {
            alert("Pedido enviado! Verifique o seu e-mail.");
            location.reload();
        });
    };
</script>
