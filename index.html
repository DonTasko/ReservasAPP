<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Admin Don Tasko | 15 Dias</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #1c1e21; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: white; padding: 30px; border-radius: 12px; text-align: center; }
        #dashboard-content { display: none; max-width: 1200px; margin: auto; }
        .grid-main { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { margin-top: 0; font-size: 18px; color: #2c3e50; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; }
        
        /* Form Manual */
        .form-manual input, .form-manual select, .form-manual textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-add { background: #27ae60; color: white; border: none; width: 100%; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* Lista 15 dias com scroll */
        .scroll-resumo { max-height: 350px; overflow-y: auto; padding-right: 5px; }
        .dia-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #f0f2f5; border-radius: 6px; margin-bottom: 2px; }
        
        /* Cores de Alerta */
        .status-ok { background: #e8f5e9; border-left: 5px solid #2ecc71; }
        .status-warning { background: #fff3e0; border-left: 5px solid #f39c12; }
        .status-full { background: #ffebee; border-left: 5px solid #e74c3c; }
        
        .pax-badge { background: #2c3e50; color: white; padding: 2px 8px; border-radius: 6px; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f8f9fa; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .btn-cancel { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2>Acesso Don Tasko</h2>
        <input type="password" id="passInput" placeholder="Palavra-passe">
        <button onclick="verificarPass()" class="btn-add">Entrar</button>
    </div>
</div>

<div id="dashboard-content">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:20px;">
        <h1>üìä Painel Administrativo</h1>
        <button onclick="carregarDados()" class="btn-add" style="width: auto; padding: 10px 20px;">üîÑ Atualizar Dados</button>
    </div>

    <div class="grid-main">
        <div>
            <div class="card">
                <h2>‚ûï Reserva Manual</h2>
                <form id="formManual" class="form-manual">
                    <input type="text" name="nome" placeholder="Nome" required>
                    <input type="tel" name="telemovel" placeholder="Telem√≥vel" required>
                    <div style="display:flex; gap:5px;">
                        <input type="date" name="data" id="dataManual" required>
                        <input type="number" name="pax" value="2" min="1" required>
                    </div>
                    <select name="horario" id="horarioManual"></select>
                    <textarea name="obs" placeholder="Observa√ß√µes..."></textarea>
                    <button type="submit" class="btn-add" id="btnManual">Gravar Reserva</button>
                </form>
            </div>

            <div class="card">
                <h2>üìÖ Pr√≥ximos 15 Dias</h2>
                <div id="resumo15" class="scroll-resumo"></div>
            </div>
        </div>

        <div class="card">
            <h2>üçΩÔ∏è Reservas para Hoje</h2>
            <table id="tabelaHoje">
                <thead>
                    <tr><th>Hora</th><th>Cliente</th><th>Pax</th><th>Notas</th><th>A√ß√£o</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyawjojVqh1BmC-osO77jB1aAjBgK42vTBWjxfhqWAjTriV-nAWxP7Snto8ZUUuGn91/exec";
    const PASS_CORRETA = "Tasko123";
    const LOTACAO_MAX = 34;

    function verificarPass() {
        if (document.getElementById('passInput').value === PASS_CORRETA) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard-content').style.display = 'block';
            document.getElementById('dataManual').value = new Date().toISOString().split('T')[0];
            carregarHorarios();
            carregarDados();
        }
    }

    function carregarHorarios() {
        fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({action: 'getHorarios'}) })
        .then(r => r.json()).then(lista => {
            document.getElementById('horarioManual').innerHTML = lista.map(h => `<option value="${h}">${h}</option>`).join('');
        });
    }

    function carregarDados() {
        fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({action: 'getDashboard'}) })
        .then(r => r.json()).then(data => {
            // Render 15 dias com cores
            const resumoDiv = document.getElementById('resumo15');
            resumoDiv.innerHTML = Object.keys(data.resumo).sort().map(d => {
                const total = data.resumo[d];
                let classe = "status-ok";
                if (total >= LOTACAO_MAX) classe = "status-full";
                else if (total >= 25) classe = "status-warning";
                
                return `<div class="dia-item ${classe}">
                    <span>${d}</span>
                    <span class="pax-badge">${total} pax</span>
                </div>`;
            }).join('');

            // Render Hoje
            const tbody = document.querySelector('#tabelaHoje tbody');
            tbody.innerHTML = data.listaHoje.length > 0 ? data.listaHoje.map(r => `
                <tr>
                    <td><b>${r.hora}</b></td>
                    <td>${r.nome}<br><small>${r.tel}</small></td>
                    <td><span class="pax-badge">${r.pax}</span></td>
                    <td style="font-size:11px; font-style:italic;">${r.obs || ''}</td>
                    <td><button class="btn-cancel" onclick="cancelar('${r.nome}', '${r.hora}')">Cancelar</button></td>
                </tr>`).join('') : "<tr><td colspan='5' style='text-align:center'>Sem reservas.</td></tr>";
        });
    }

    function cancelar(nome, hora) {
        if (confirm(`Cancelar reserva de ${nome}?`)) {
            fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({action: 'cancelarAdmin', nome: nome, hora: hora}) })
            .then(() => { alert("Cancelada!"); carregarDados(); });
        }
    }

    document.getElementById('formManual').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnManual');
        btn.disabled = true; btn.innerText = "A gravar...";
        const dados = Object.fromEntries(new FormData(this).entries());
        dados.action = "reservaManual";
        fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify(dados) })
        .then(() => { alert("Sucesso!"); this.reset(); btn.disabled = false; btn.innerText = "Gravar Reserva"; carregarDados(); });
    };
</script>
</body>
</html>
